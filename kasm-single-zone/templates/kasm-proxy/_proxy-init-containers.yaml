{{- define "proxy.initContainers" }}
{{- $values := index . 0 -}}
{{- $serviceName := index . 1 -}}
{{- $servicePort := index . 2 -}}
- name: {{ $serviceName }}-is-ready
  image: alpine/curl:8.8.0
  imagePullPolicy: IfNotPresent
  command:
  - /bin/sh
  - -ec
  args:
  - |
      while ! curl http://{{- $serviceName -}}:{{- $servicePort -}}/__healthcheck 2>/dev/null; do echo "Waiting for the {{- $serviceName -}} server to start..."; sleep 5; done
{{- end }}
